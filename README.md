# SecureStorage
Приложение для ОС Android, осуществляющее хранение данных в зашифрованном виде.

В Android Studio были добавлены пакеты NDK и CMake, т.к. они необходимы для разработки библиотеки. Далее был создан проект с поддержкой Native C++. Автоматически создалась директория cpp с вложенным файлом native-lib.cpp. В данном файле далее был прописан алгоритм шифрования AES.

Приложения на Android, как правило, написаны на языке Java, с его элегантными объектно-ориентированным дизайном. Однако в случае, если необходимо преодолеть ограничения языка Java, такие как управление памятью и производительность, посредством программирования непосредственно в нативный интерфейс Android. Для этих целей, помимо Android SDK, Android предоставляет Native Developmemt Kit (NDK), реализующий поддержку разработки на C/C++.

NDK предоставляет все инструменты (компиляторы, библиотеки и заголовочные файлы) для создания приложений, которые получают доступ к устройству нативно. Нативный код обеспечит высокую производительность там, где Java имеет ограничения.

При сборке APK-файла, Gradle компилирует код на C/C++ в нативную библиотеку, после чего добавляет в APK-файл. Затем код на Java сможет обращаться к библиотеке и её методам через инфраструктуру JNI (Java Native Interface).

Защита в виде пароля была реализована при помощи PasscodeView. На рисунке ниже представлен интерфейс проверки пароля. Хранение пароля происходит в Realtime Database с использованием Firebase. Пароль хранится в шифрованном виде. Для этого был реализован класс Crypt, где осуществляется зашифрование пароля алгоритмом DES.

Так как у нас базой пользуется только текущий пользователь, то нет необходимости дергать его при изменении значения внутри нее, когда он же это изменение и вносит. Поэтому использовался addListenerForSingleValueEvent, который «дернет» пользователя только один раз. Внутри этого listener происходит проверка на верность пароля. Берется из базы запись зашифрованного пароля, расшифровывается и проверяется с тем, что ввел пользователь. Если проверка пройдена, то запускается новая activity.

![image](https://github.com/Kattarinea/SecureStarage/assets/65298723/2140513f-1450-493d-bc03-b72aa8d0e1d7)

В классе Storage реализован вывод содержимого директории encrypt, если она есть. Если директорий encrypt и decrypt еще нет, то они создаются.

Для каждого файла внутри encrypt проверяется, был ли он ранее зашифрован. Для этого шифрованные файлы помечаются расширением «.secure». Если файл еще не шифровали, то внутри функции encryptFile вызывается функция, реализованная на С++, Crypt_AES. 

Нельзя просто так взять и вызвать какой-либо из нативных методов с помощью Java-кода, для этого нужно реализовать метод, который будет вызывать особым образом. В конце класса Storage был прописан прототип public native boolean Crypt_AES(String path, boolean flag). С помощью метода System.loadLibrary() загружаем библиотеку из папки cpp. Далее уже можно вызывать методы из этой библиотеки.

В External Build Files можно увидеть скрипт сборки CMake или ndk-build. Аналогично тому, как build.gradle сообщает Gradle о том, как собрать приложение, CMake и ndk-build требуют, чтобы скрипт сборки знал, как создать свою нативную библиотеку. Для новых проектов Android Studio создаёт файл CMakeList.txt и помещает его в корневой каталог модуля.

В методе Crypt_AES() происходит инициализация ключа шифрования, считывание файла, с которым будет происходить работа, в char* buff. В зависимости от флага вызываются функции класса AES: Cipher – шифрование файла, InvCipher – расшифрование.

Результат записывается в файл с измененным путем. Файл кладется в директорию decrypt.

В приложении также была реализована смена пароля и обновление activity с файлами внутри директории encrypt. На рисунках ниже представлен результат работы разработанного приложения.

![image](https://github.com/Kattarinea/SecureStarage/assets/65298723/0bb55a70-1531-48ef-a526-ee9caa46e7f9)

При нажатии на item listView появляется notification с вопросом, хочет ли пользователь расшифровать выбранный файл.

![image](https://github.com/Kattarinea/SecureStarage/assets/65298723/84b98399-aba5-4c85-b2c4-e2f0b0663ae4)



